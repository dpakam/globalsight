<!-- *************************************************************** -->
<!-- *                                                             * -->
<!-- *                   GlobalSight Common Build file             * -->
<!-- *                                                             * -->
<!-- *************************************************************** -->
<project name="Common" default="build" basedir=".">

  <target name="init">
    <echo message="***** Common build file *****"/>
    <tstamp/>
    <!-- Specify the individual source directories. -->
    <property name="commonBase" value="." />

    <!-- Source directory -->
    <property name="commonSrcDir" value="../../envoy/src/java" /> 

    <property 
        name="commonClasspath" 
        value="${classpath};
               ${tmpclasses}">
    </property>
  </target>

  <target name="prepare" depends="init">
    <mkdir dir="${commonclasses}" />
    <mkdir dir="${tmpclasses}" />

    <!-- Pre-compile files needed to compile common classes.    -->
    <!-- This task should be removed as soon as the dependency  -->
    <!-- problem resolved.                                      -->
    <!--
    <echo>
        ***** Compiling Dependent files for Common. 
              This shouldn't run if the dependency problem is resolved. 
    </echo>
    <javac target="${target}" srcdir="${commonSrcDir}"
	   destdir="${tmpclasses}"
	   classpath="${commonClasspath}"
	   includes="com/globalsight/everest/foundation/Timestamp.java,
		     com/globalsight/everest/foundation/UserInformation.java,
		     com/globalsight/everest/foundation/User.java,
		     com/globalsight/everest/foundation/UserRole.java,
		     com/globalsight/everest/foundation/ContainerRole.java,
		     com/globalsight/everest/foundation/Role.java,
		     com/globalsight/everest/util/system/SystemConfiguration.java,
		     com/globalsight/everest/util/system/SystemConfigurationConstants.java,
		     com/globalsight/everest/util/system/SystemConfigParamNames.java,
		     com/globalsight/everest/util/server/RegistryLocator.java,
		     com/globalsight/everest/util/server/ServerRegistry.java,
		     com/globalsight/everest/util/server/ServerRegistryImpl.java,
		     com/globalsight/everest/util/server/ServerDefaults.java,
		     com/globalsight/everest/util/system/PropertiesSystemConfig.java,
		     com/globalsight/everest/usermgr/UserManager.java,
		     com/globalsight/everest/usermgr/UserManagerException.java,
		     com/globalsight/util/**/*.java, com/globalsight/log/**/*.java" />
    -->
  </target>

  <target name="compile" depends="prepare">
    <echo message="***** Compiling GlobalSight Common" />
    <javac target="${target}" srcdir="${commonSrcDir}"
	   destdir="${commonclasses}"
	   classpath="${commonClasspath}"
	   includes="com/globalsight/util/**/*.java, com/globalsight/log/**/*.java,
	             everest/foundation/GlobalSightLocale.java" />
           <!-- GlobalSightLocale.java should be moved to ling soon -->
  </target>


  <target name="build" depends="compile">
    <echo message="***** Building common jar file" />
    <jar jarfile="${commonJar}"
         basedir="${commonclasses}"
	 includes="com/**" />
  </target>
	
  <!-- Delete all the generated target files -->
  <target name="clean" depends="init">
    <delete dir="${commonclasses}" />

    <!-- commonTmpClasses should be removed as soon -->
    <!--     as the dependency problem resolved     -->
    <delete dir="${tmpclasses}" />
  </target>

  <!-- Build the component from scratch -->
  <target name="cleanbuild" depends="clean, build">
  </target>

</project>
